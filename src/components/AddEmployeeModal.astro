---
---
<!-- Add Employee Modal -->
<div id="addEmployeeModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add Employee</h2>
      <button id="closeModal" class="close-btn">&times;</button>
    </div>
    <form id="addEmployeeForm">
      <div class="form-group">
        <label for="employeeName">Full Name *</label>
        <input 
          type="text" 
          id="employeeName" 
          placeholder="e.g., John Doe" 
          required
        >
      </div>

      <div class="form-group">
        <label for="employeeAge">Age *</label>
        <input 
          type="number" 
          id="employeeAge" 
          placeholder="e.g., 28" 
          min="18" 
          required
        >
      </div>

      <div class="form-group">
        <label for="employeeGhanaCard">Ghana Card Number *</label>
        <input 
          type="text" 
          id="employeeGhanaCard" 
          placeholder="e.g., GHA-123-456-789" 
          required
        >
      </div>

      <div class="form-group">
        <label for="employeeStatus">Employment Status *</label>
        <select id="employeeStatus" required>
          <option value="">-- Select Status --</option>
          <option value="Hireable">Hireable</option>
          <option value="Employed">Employed</option>
          <option value="Misconduct">Misconduct</option>
          <option value="Theft">Theft</option>
          <option value="On Leave">On Leave</option>
          <option value="Terminated">Terminated</option>
        </select>
      </div>

      <div class="form-group">
        <label for="employeeImage">Profile Image (Optional)</label>
        <input 
          type="file" 
          id="employeeImage" 
          accept="image/*"
        >
      </div>

      <div id="formMessage" class="form-message"></div>

      <div class="form-actions">
        <button type="button" id="cancelBtn" class="btn-secondary">Cancel</button>
        <button type="submit" class="btn-primary">Add Employee</button>
      </div>
    </form>
  </div>
</div>

<style>
/* Modal overlay */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

/* Modal content - matching login.css styling */
.modal-content {
  background-color: rgb(248, 246, 246);
  border-radius: 8px;
  padding: 2rem;
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  border-bottom: 1px solid #ddd;
  padding-bottom: 1rem;
}

.modal-header h2 {
  margin: 0;
  font-size: 2rem;
  color: rgb(11, 11, 11);
}

.close-btn {
  background: none;
  border: none;
  font-size: 28px;
  cursor: pointer;
  color: #999;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.close-btn:hover {
  color: rgb(11, 11, 11);
}

/* Form styling - matching login.css */
form {
  width: 100%;
  display: flex;
  gap: 1rem;
  flex-direction: column;
}

.form-group {
  margin-bottom: 1rem;
  display: flex;
  flex-direction: column;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: rgb(11, 11, 11);
  font-size: 1rem;
}

.form-group input,
.form-group select {
  padding: 1.5rem;
  outline: none;
  border: none;
  color: rgb(11, 11, 11);
  font-size: 1.2rem;
  background-color: white;
  transition: all 0.2s ease;
}

.form-group input:focus,
.form-group select:focus {
  background-color: #f0f0f0;
  box-shadow: inset 0 0 0 2px rgb(11, 11, 11);
}

.form-message {
  margin-bottom: 1rem;
  padding: 1.5rem;
  border-radius: 6px;
  display: none;
  font-size: 1rem;
  font-weight: 500;
}

.form-message.error {
  display: block;
  background: #fee;
  color: #c33;
  border: 1px solid #fcc;
}

.form-message.success {
  display: block;
  background: #efe;
  color: #3c3;
  border: 1px solid #cfc;
}

/* Form actions - buttons matching login.css style */
.form-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
}

.btn-primary,
.btn-secondary {
  flex: 1;
  padding: 1.5rem;
  border: none;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 500;
}

.btn-primary {
  color: #fefefe;
  background-color: rgb(11, 11, 11);
}

.btn-primary:hover {
  background-color: #333;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(11, 11, 11, 0.2);
}

.btn-secondary {
  background-color: #ddd;
  color: rgb(11, 11, 11);
  border: 1px solid #999;
}

.btn-secondary:hover {
  background-color: #ccc;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
</style>

<script type="module">
  import { auth } from '/scripts/auth.js';
  import { createEmployee } from '/scripts/db.js';
  import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';

  const modal = document.getElementById('addEmployeeModal');
  const form = document.getElementById('addEmployeeForm');
  const closeBtn = document.getElementById('closeModal');
  const cancelBtn = document.getElementById('cancelBtn');
  const formMessage = document.getElementById('formMessage');
  const submitBtn = form.querySelector('button[type="submit"]');

  let currentUser = null;

  // Check auth state
  onAuthStateChanged(auth, (user) => {
    currentUser = user;
  });

  // Open modal when "Add Employee" is clicked (handled in floating-toolbar.js)
  window.openAddEmployeeModal = () => {
    modal.style.display = 'flex';
  };

  // Close modal
  const closeAddEmployeeModal = () => {
    modal.style.display = 'none';
    form.reset();
    formMessage.textContent = '';
    formMessage.className = 'form-message';
  };

  closeBtn.addEventListener('click', closeAddEmployeeModal);
  cancelBtn.addEventListener('click', closeAddEmployeeModal);

  // Close modal when clicking outside
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeAddEmployeeModal();
    }
  });

  // Handle form submission
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    if (!currentUser) {
      showMessage('You must be logged in to add an employee', 'error');
      return;
    }

    // Get form values
    const name = document.getElementById('employeeName').value.trim();
    const age = parseInt(document.getElementById('employeeAge').value);
    const ghanaCard = document.getElementById('employeeGhanaCard').value.trim();
    const status = document.getElementById('employeeStatus').value;
    const imageFile = document.getElementById('employeeImage').files[0];

    // Validation
    if (!name || !age || !ghanaCard || !status) {
      showMessage('Please fill in all required fields', 'error');
      return;
    }

    if (age < 18) {
      showMessage('Employee must be at least 18 years old', 'error');
      return;
    }

    // Disable submit button during processing
    submitBtn.disabled = true;
    showMessage('Adding employee...', 'success');

    try {
      // Prepare employee data
      const employeeData = {
        ownerId: currentUser.uid,
        ownerDisplayName: currentUser.displayName || currentUser.email,
        name,
        age,
        ghanaCard,
        status,
        imageUrl: '', // Firebase Storage upload would go here
      };

      // Create employee in Firestore
      const employeeId = await createEmployee(employeeData);
      console.log('Employee added:', employeeId);

      showMessage('Employee added successfully!', 'success');
      form.reset();

      // Close modal after 1.5 seconds
      setTimeout(() => {
        closeAddEmployeeModal();
        // Optionally refresh the dashboard if they're on it
        window.location.reload(); // Or dispatch custom event to refresh employee list
      }, 1500);

    } catch (error) {
      console.error('Error adding employee:', error);
      showMessage(`Error: ${error.message}`, 'error');
    } finally {
      submitBtn.disabled = false;
    }
  });

  function showMessage(msg, type) {
    formMessage.textContent = msg;
    formMessage.className = `form-message ${type}`;
  }
</script>
